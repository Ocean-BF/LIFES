<div class="card">
  <div class="clock-time" id="clock-time">--:--</div>
  <div class="clock-date" id="clock-date">--/--/--</div>
</div>
<div class="card">
  <div id="weather">天気を取得中...</div>
</div>

<script>
  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const y = now.getFullYear();
    const mo = String(now.getMonth() + 1).padStart(2, '0');
    const d = String(now.getDate()).padStart(2, '0');
    const wd = ["日", "月", "火", "水", "木", "金", "土"][now.getDay()];
    document.getElementById("clock-time").textContent = h + ":" + m;
    document.getElementById("clock-date").textContent = `${y}/${mo}/${d}（${wd}）`;
  }

  setInterval(updateClock, 1000);
  updateClock();

  async function fetchWeather(lat, lon) {
    const apiKey = "2e182b7d1ed7a9117780e6c105646376";
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=ja&appid=${apiKey}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      const desc = data.weather[0].description;
      const icon = data.weather[0].icon;
      const temp = data.main.temp.toFixed(1);
      const city = data.name;
      const iconUrl = `https://openweathermap.org/img/wn/${icon}@2x.png`;
      document.getElementById("weather").innerHTML = `${city}：${desc}（${temp}℃） <img src="${iconUrl}" alt="${desc}">`;
    } catch {
      document.getElementById("weather").textContent = "天気情報の取得に失敗しました";
    }
  }

  function getWeather() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          fetchWeather(pos.coords.latitude, pos.coords.longitude);
        },
        err => {
          fetchWeather(34.6901, 135.1956); // 神戸
        }
      );
    } else {
      fetchWeather(34.6901, 135.1956);
    }
  }

  getWeather();
</script>
