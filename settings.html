<style>
  .panel {
    background-color: rgba(255, 255, 255, 0.85);
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    font-size: 16px;
  }
  label {
    display: block;
    margin-top: 12px;
  }
  input, button {
    font-size: 16px;
    padding: 10px;
    width: 100%;
    margin-top: 5px;
    box-sizing: border-box;
  }
  button.logout {
    background-color: #f44336;
    color: white;
  }
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    border-top: 1px solid #ccc;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
  }
  .bottom-nav a {
    text-decoration: none;
    color: #444;
    font-size: 12px;
    text-align: center;
    flex: 1;
  }
  .bottom-nav span {
    display: block;
    font-size: 20px;
  }
</style>

<div class="panel">
  <h2>アカウント</h2>
  <label>ログイン中のメールアドレス:</label>
  <div id="user-email">読み込み中...</div>
  <label for="new-password">新しいパスワード:</label>
  <input type="password" id="new-password" placeholder="新しいパスワードを入力">
  <button onclick="changePassword()">パスワードを変更</button>
</div>

<div class="panel">
  <h2>表示設定</h2>
  <label for="bg-color">背景色:</label>
  <input type="color" id="bg-color">
  <label for="bg-file">背景画像を選択:</label>
  <input type="file" id="bg-file" accept="image/*">
  <label for="card-opacity">カードの透明度:</label>
  <input type="range" id="card-opacity" min="0.5" max="1" step="0.05">
  <button onclick="resetStyles()">スタイルをリセット</button>
</div>

<div class="panel">
  <h2>ログアウト</h2>
  <button class="logout" onclick="logout()">ログアウト</button>
</div>

<nav class="bottom-nav">
  <a href="#" onclick="loadPage('home.html')"><span>🏠</span>ホーム</a>
  <a href="#" onclick="loadPage('life.html')"><span>🛍️</span>生活</a>
  <a href="#" onclick="loadPage('edu.html')"><span>📘</span>教育</a>
  <a href="#" onclick="loadPage('health.html')"><span>💊</span>健康</a>
  <a href="#" onclick="loadPage('settings.html')"><span>⚙️</span>設定</a>
</nav>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const client = supabase.createClient(
    "https://mzuqsfoqkaopxhyggwyk.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16dXFzZm9xa2FvcHhoeWdnd3lrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1NDcyMjksImV4cCI6MjA2MzEyMzIyOX0.vssAVSGX8kFf7v5wEN8Mxi4-4gb4hCSo3X3fEYp97u0"
  );

  client.auth.getUser().then(({ data: { user } }) => {
    if (user) {
      document.getElementById("user-email").textContent = user.email;
    }
  });

  async function changePassword() {
    const pw = document.getElementById("new-password").value;
    if (pw.length < 6) {
      alert("6文字以上のパスワードを入力してください。");
      return;
    }
    const { error } = await client.auth.updateUser({ password: pw });
    alert(error ? "変更失敗: " + error.message : "パスワードを変更しました。");
  }

  const bgInput = document.getElementById("bg-color");
  const fileInput = document.getElementById("bg-file");
  const opacity = document.getElementById("card-opacity");

  bgInput.oninput = () => {
    document.documentElement.style.setProperty("--bg-color", bgInput.value);
    localStorage.setItem("lifes_bg_color", bgInput.value);
  };

  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (file) {
      const url = URL.createObjectURL(file);
      document.body.style.backgroundImage = `url('${url}')`;
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundRepeat = "no-repeat";
      localStorage.setItem("lifes_bg_image", url);
    }
  };

  opacity.oninput = () => {
    const val = opacity.value;
    document.documentElement.style.setProperty("--card-color", `rgba(255,255,255,${val})`);
    localStorage.setItem("lifes_card_opacity", val);
  };

  function resetStyles() {
    localStorage.clear();
    location.reload();
  }

  async function logout() {
    await client.auth.signOut();
    localStorage.clear();
    location.href = "index.html";
  }

  // 初期反映
  window.onload = () => {
    const bg = localStorage.getItem("lifes_bg_color");
    const img = localStorage.getItem("lifes_bg_image");
    const op = localStorage.getItem("lifes_card_opacity");

    if (bg) document.documentElement.style.setProperty("--bg-color", bg);
    if (img) {
      document.body.style.backgroundImage = `url('${img}')`;
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundRepeat = "no-repeat";
    }
    if (op) document.documentElement.style.setProperty("--card-color", `rgba(255,255,255,${op})`);
  };
</script>
