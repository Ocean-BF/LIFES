<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>単価計算・履歴管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 0;
    }
    .tab-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    .tab-button {
      padding: 8px 16px;
      border: 2px solid #007bff;
      background: white;
      font-weight: bold;
      border-radius: 6px;
      font-size: 1rem;
      min-width: 100px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .tab-button.active {
      background: #007bff;
      color: white;
    }
    .section {
      padding: 10px;
    }
    .row {
      display: flex;
      align-items: center;
      margin: 8px 0;
      gap: 8px;
      flex-wrap: wrap;
      width: 100%;
      box-sizing: border-box;
    }
    .col.label {
      width: 30%;
      min-width: 90px;
      font-weight: bold;
      font-size: 1.1rem;
    }
    .col.input {
      width: 60%;
    }
    .col.button {
      width: 10%;
      text-align: right;
    }
    .col.input input,
    .col.input select {
      width: 100%;
      padding: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .unit-price {
      font-size: 1.3rem;
      font-weight: bold;
    }
    .row.buttons, .row.submit-row {
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
      width: 100%;
    }
    button {
      padding: 8px 16px;
      font-size: 1rem;
      border-radius: 4px;
      font-weight: bold;
      border: 1px solid #007bff;
      background: white;
      color: #007bff;
      cursor: pointer;
      transition: 0.2s;
    }
    button.btn-reset {
      background-color: #f5bcbc;
      border: 1px solid #cc9999;
      color: #333;
    }
    button.btn-submit {
      background-color: #007bff;
      color: #fff;
      border: none;
    }
    .status {
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
      color: red;
    }
    /* 履歴テーブル */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      min-width: 600px;
      table-layout: fixed;
    }
    .history-table th, .history-table td {
      border: 1px solid #ccc;
      padding: 6px;
      font-size: 1rem;
      word-break: break-word;
      text-align: center;
    }
    /* モーダル */
    .modal {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 12px;
      min-width: 220px;
      max-width: 95vw;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      text-align: center;
    }
    /* スマホ対応 */
    @media (max-width: 600px) {
      .row {
        flex-direction: column;
        align-items: stretch;
        gap: 4px;
      }
      .col.label, .col.input, .col.button {
        width: 100%;
        min-width: unset;
        text-align: left;
      }
      .history-table, .history-table th, .history-table td {
        font-size: 0.9rem;
        min-width: 80px;
      }
      .tab-button {
        min-width: 80px;
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>
  <div class="tab-buttons">
    <button id="formTab" class="tab-button active" type="button">入力フォーム</button>
    <button id="historyTab" class="tab-button" type="button">履歴一覧</button>
  </div>

  <!-- 入力フォーム -->
  <div id="formSection" class="section">
    <form id="unitForm" autocomplete="on">
      <div class="row">
        <div class="col label"><label for="item_name">商品名</label></div>
        <div class="col input"><input id="item_name" name="item_name" autocomplete="off"></div>
        <div class="col button"><button type="button" class="dropdown-btn" data-target="item_name" aria-label="商品名候補">▼</button></div>
      </div>
      <div class="row">
        <div class="col label"><label for="category">カテゴリ</label></div>
        <div class="col input"><input id="category" name="category" autocomplete="off"></div>
        <div class="col button"><button type="button" class="dropdown-btn" data-target="category" aria-label="カテゴリ候補">▼</button></div>
      </div>
      <div class="row">
        <div class="col label"><label for="price">価格</label></div>
        <div class="col input"><input id="price" name="price" type="number" inputmode="decimal" min="0" step="any"></div>
        <div class="col button"></div>
      </div>
      <div class="row">
        <div class="col label"><label for="quantity">数量</label></div>
        <div class="col input"><input id="quantity" name="quantity" type="number" min="1" value="1"></div>
        <div class="col button"></div>
      </div>
      <div class="row">
        <div class="col label"><label for="volume">内容量</label></div>
        <div class="col input"><input id="volume" name="volume" type="number" min="1" value="1"></div>
        <div class="col button"></div>
      </div>
      <div class="row">
        <div class="col label"><label for="shop_name">店名</label></div>
        <div class="col input"><input id="shop_name" name="shop_name" autocomplete="off"></div>
        <div class="col button"><button type="button" class="dropdown-btn" data-target="shop_name" aria-label="店名候補">▼</button></div>
      </div>
      <div class="row">
        <div class="col label">単価</div>
        <div class="col input"><div id="unitPriceDisplay" class="unit-price" aria-live="polite">-- 円</div></div>
        <div class="col button"></div>
      </div>
      <div class="row buttons">
        <button type="button" id="taxIn">税込</button>
        <button type="button" id="taxReset">非課税</button>
        <button type="button" id="taxOut">税抜</button>
      </div>
      <div class="row submit-row">
        <button type="button" id="resetButton" class="btn-reset">リセット</button>
        <button type="submit" id="submitButton" class="btn-submit">登録</button>
      </div>
      <div id="status" class="status" aria-live="polite"></div>
    </form>
  </div>

  <!-- 履歴一覧 -->
  <div id="historySection" class="section" style="display:none;">
    <div class="filter-row">
      <div class="row">
        <label for="filterItem">商品名</label>
        <select id="filterItem" name="filterItem"><option value="">すべて</option></select>
      </div>
      <div class="row">
        <label for="filterCategory">カテゴリ</label>
        <select id="filterCategory" name="filterCategory"><option value="">すべて</option></select>
      </div>
    </div>
    <div id="historyListWrapper">
      <div id="historyList"></div>
    </div>
  </div>

  <!-- モーダル：選択肢 -->
  <div id="modal" class="modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modalList">
    <div class="modal-content">
      <ul id="modalList"></ul>
    </div>
  </div>
  <!-- モーダル：削除確認 -->
  <div id="deleteModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-content">
      <p>本当に削除しますか？</p>
      <button id="confirmDeleteBtn">削除</button>
      <button id="cancelDeleteBtn">キャンセル</button>
    </div>
  </div>

  <!-- JavaScript（元のロジックをそのまま利用可） -->
  <script>
    // ここに元のJavaScriptをそのまま貼り付けてください
    // 例：Supabase初期化、単価計算、登録・履歴・編集・削除・モーダル操作など
  </script>
</body>
</html>
